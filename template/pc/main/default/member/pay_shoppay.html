<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>购物车结算-{$SiteName}</title>
<meta name="keywords" content="{$SiteKeyWord}" />
<meta name="description" content="{$SiteDescription}" />
<link rel="stylesheet" rev="stylesheet" href="{$Default_tplPath}skin/g2013.css?{$CacheHash}" />
<link rel="stylesheet" rev="stylesheet" href="{$Default_tplPath}skin/styleX4.css?{$CacheHash}" />
<link rel="stylesheet" rev="stylesheet" href="{$Default_tplPath}skin/kuaisonORDER.css?{$CacheHash}" />
<script src="{$Default_tplPath}js/jquery-1.10.2.min.js?{$CacheHash}"></script>
<script src="{$Default_tplPath}js/commonX4.js?{$CacheHash}"></script>
<script>var siteUrl = '{$SiteUrl}';</script>
</head>

<body>
<div class="wrapper">
	{$Mh163k_快送_头部}
	<div class="content bgk">
		<div class="w-1200">
			<div class="stepBlock">
				<h2 class="second"></h2>
				<p class="stepTxt">
					<span class="one selected">加入购物车</span>
					<span class="two selected">确认订单内容</span>
					<span class="three">成功提交并付款</span>	
					<span class="four">确认配送并评论</span>	
				</p>
			</div>
			<div class="mod_01">
				<div class="hd clearfix"><a href="/member/myorder.aspx?action=myaddress" target="_blank" class="right blue_font" style="font-size:12px; font-weight:normal;">管理配送地址</a>确认配送地址<span class="smalltit">本店外送时间：<span class="display1{$startkill}">{$startdate HH:mm}-{$enddate HH:mm} </span><span class="display1{$start2kill}">{$startdate2 HH:mm}-{$enddate2 HH:mm}</span></span></div>
				<div class="bd">
					<ul class="addressList clearfix node{$peisongtype}" id="addressList">
						{$regusers_address_list}
						<li class="item item0" data-isziqu="{$isziqu}" data-id="0"><span class="tit"></span><input type="radio" name="sleAdress" id="sleAdress0" data-result="{$peisongtype}" value="0" class="radio" /> <span class="name"><span class="chrname">上门自取</span></span><span class="chraddress">请务必在规定时间内完成取货哦~</span></li><li><a href="javascript:void(0);" id="addAddress_btn" class="s_btn_red node{$peisongtype}">添加地址</a></li>
					</ul>
					<div class="mod_02 addeditNode" id="addeditNode">
						<div class="hds" id="s_tit">请填写新的配送地址</div>
						<div class="bds address">
							<form method="get" id="myformAddress">
							<input type="hidden" id="s_id" value="" />
							<input type="hidden" id="s_styleid" value="" />
							<input type="hidden" id="s_ismoren" value="1" />
							<p class="p"><span class="a">联系人：</span><span class="b"><input type="text" class="s_ipt" id="s_realname" /></span></p>
							<p class="p"><span class="a">电话：</span><span class="b"><input type="text" class="s_ipt" id="s_phone" /></span></p>
							<p class="p"><span class="a">配送地址：</span><span class="b"><input type="text" class="s_ipt" id="s_address" /></span></p>
							<p class="p"><span class="a">&nbsp;</span><span class="b"><button class="s_btn" type="submit">确认</button>　<button class="s_btn2 close" type="button">取消</button></span><span class="b" id="tip_error"></span></p>
							</form>
						</div>
					</div>
					<div class="addeditMask" id="addeditMask"></div>
				</div>
			</div>
			<div class="mod_01">
				<div class="hd">确认您的订单</div>
				<div class="order_detial">
					<!--<div class="shop_list clearfix" id="shop_list"><a href="{$SiteUrl}k{$shopid}.html" target="_blank" class="right">进入店铺</a>{$PayShopMenu}</div>-->
					<div class="table table1">
						<p class="th">
							<span class="a">商品名称</span>
							<span class="b">商品数量</span>
							<span class="c">商品单价</span>
							<span class="d">小计</span>
							<span class="e">操作</span>
						</p>
						<p class="shop clearfix"><span class="left">店铺：<a href="{$SiteUrl}k{$shopid}.html" target="_blank">{$name}</a></span><span class="right">店铺总计：&yen;{$chrmoneyAll}</span></p>
						{$pay_small_list}
					</div>
					<p style="text-align:right; margin-top:25px;">选择抵用券：<select name="" disabled><option value="0">暂无可用抵用券</option></select></p>
					<p class="total">商品总计：<em class="em">&yen;<span id="chrmoneyAll">{$chrmoneyAll}</span></em>　满减优惠：<em class="em">-&yen;{$chrmoneyyouhui}</em><span class="display1{$discount1}">(满{$discount}减{$discount1})</span>　配送费：<em class="em">&yen;{$chrmoneyYunfei}</em><span class="display1{$daijinnum}">　{$daijinname}抵：-{$daijinnumdikou}</span>　<em class="em2">需支付：&yen;<span id="chrmoneyPay">{$chrmoneyPay}</span></em></p>
				</div>
			</div>
<form name="Form11" id="Form11" method="post" action="../pay/default.aspx" target="pay">
	<input type="hidden" name="shopid" id="shopid" value="{$shopid}" />
	<input type="hidden" name="addressid" id="addressid" value="" />
	<input type="hidden" name="action" value="6">
			<div class="mod_01" id="zhifuNode">
				<div class="hd">选择支付方式</div>
				<div class="bd">
					<div class="isonlineNode">
						<ul class="payMethod clearfix">
							<li class="display1{$paytype}"><input type="radio" name="payid" onClick="bankradio('99');" value="99">&nbsp;<img src="{$Default_tplPath}images/payimg0.png" /></li>
							{$paydetails}
							<input type="radio" id="payid98" name="payid" value="98" style="display:none;" />
						</ul>
	<div class="bankradio" id="bankradio" style="display:none;">
	     <ul class="bank">
          <div class="a1 clearfix">
	    <li><input id="gsyh" name="bank" type="radio"  style="vertical-align:middle; margin-right:6px;" onClick="show1(this,'2');" value="gsyh" /><img src="{$Default_tplPath}images/bank_gsyh2.gif" alt="中国工商银行" align="middle" /></li>	

	         
	     
	     <li><input id="zsyh" name="bank" type="radio"  style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'11');" value="zsyh" /><img src="{$Default_tplPath}images/bank_zsyh2.gif" alt="招商银行" align="middle" /></li>	
	     
		
         
	     <li><input id="ccb" name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'5');" value="jsyh" /><img src="{$Default_tplPath}images/bank_jsyh2.gif" alt="中国建设银行" align="middle" /></li>	
         
         <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'3');" value="nyyh" /><img src="{$Default_tplPath}images/bank_nyyh2.gif" alt="中国农业银行" align="middle" /></li>
		 
		 <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'4');" value="zgyh" /><img src="{$Default_tplPath}images/bank_zgyh2.gif" alt="中国银行" align="middle" /></li>
     
        </div>
        <div class="a2 clearfix">
         
	     <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'1');" value="jtyh" /><img src="{$Default_tplPath}images/bank_jtyh.gif" alt="交通银行" align="middle" /></li>
		 
	     
	    
	     <li><input id="hxb" name="bank" type="radio"  style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'8');" value="hxb" /><img src="{$Default_tplPath}images/bank_hxyh.gif" alt="华夏银行" align="middle" /></li>	
	     
	     
	     <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'12');" value="xyyh" /><img src="{$Default_tplPath}images/bank_xyyh.gif" alt="兴业银行" align="middle" /></li>
		 
		 <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'9');" value="msyh" /><img src="{$Default_tplPath}images/bank_msyh2.gif" alt="中国民生银行" align="middle" /></li>
         
        
        <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'10');" value="gfyh" /><img src="{$Default_tplPath}images/bank_gdfz.gif" alt="广东发展银行" align="middle" /></li>
	     </div>
         <div class="a3 clearfix">
		   
	     <li><input name="bank" type="radio"  style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'16');" value="szfzyh" /><img src="{$Default_tplPath}images/bank_payh.gif" alt="平安银行" align="middle" /></li>
	     
         
         <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'13');" value="shpfyh" /><img src="{$Default_tplPath}images/bank_pfyh.gif" alt="上海浦东发展银行" align="middle" /></li>
		 
		 <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'6');" value="zxyh" /><img src="{$Default_tplPath}images/bank_zxyh.gif" alt="中信银行" align="middle" /></li>
	     
		
	     
	     <li><input name="bank" type="radio"  style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'7');" value="gdyh" /><img src="{$Default_tplPath}images/bank_gdyh.gif" alt="光大银行" align="middle" /></li>
	     
         
	     
	     <li><input name="bank" type="radio" style="vertical-align:middle;margin-right:6px;" onClick="show1(this,'20');" value="njyh" /><img src="{$Default_tplPath}images/bank_njyh.gif" alt="南京银行" align="middle" /></li>
         
		 </div>
         <div class="a4 clearfix">
	     <li><input id="psbc" name="bank" style="vertical-align:middle;margin-right:6px;" type="radio" onClick="show1(this,'14');" value="psbc" /><img src="{$Default_tplPath}images/bank_psbc.gif" alt="邮政储蓄银行" align="middle" /></li>	
		 
		 <li><input id="hzyh" name="bank" style="vertical-align:middle;margin-right:6px;" type="radio" onClick="show1(this,'21');" value="hzyh" /><img src="{$Default_tplPath}images/bank_hangzhou.jpg" alt="杭州银行" align="middle" /></li>
	     
	       
	     <li><input id="nbyh" name="bank" style="vertical-align:middle;margin-right:6px;" type="radio" onClick="show1(this,'22');" value="nbyh" /><img src="{$Default_tplPath}images/bank_nbyh.gif" alt="宁波银行" align="middle" /></li>
	     
		<li><input id="dyyh" name="bank" style="vertical-align:middle;margin-right:6px;" type="radio" onClick="show1(this,'15');" value="dyyh" /><img src="{$Default_tplPath}images/bank_dyyh.gif" alt="东亚银行" align="middle" /></li>
		 
		  <li><input id="hbyh" name="bank" style="vertical-align:middle;margin-right:6px;" type="radio" onClick="show1(this,'17');" value="hbyh" /><img src="{$Default_tplPath}images/bank_hbyh.gif" alt="河北银行" align="middle" /></li>
	     </div>
         <div class="a5 clearfix">
	     
		   <li><input id="hsyh" name="bank" style="vertical-align:middle;margin-right:6px;" type="radio" onClick="show1(this,'18');" value="hsyh" /><img src="{$Default_tplPath}images/bank_hsyh.gif" alt="徽商银行" align="middle" /></li>
		  
		  <li><input id="tjyh" name="bank" style="vertical-align:middle;margin-right:6px;" type="radio" onClick="show1(this,'19');" value="tjyh" /><img src="{$Default_tplPath}images/bank_tjyh.gif" alt="天津银行" align="middle" /></li>
             </div>
	     </ul>
		<p style="margin:10px 0 0 20px;"><strong>请选择银行卡类型：</strong><input name="pmode_kid" type="radio" checked value="1" />储蓄卡　<input name="pmode_kid" type="radio" value="2" />信用卡　<input name="pmode_kid" type="radio" value="4" />企业对公户</p>
		 
		 
	   </div>
	  				 </div>
					<input type="hidden" name="pmode_id"  id="pmode_id" value="" />
					<input name="pmode_zid" type="hidden" value="1" />
				</div>
			</div>
			<div class="mod_01">
				<div class="hd">给店家留言</div>
				<div class="guest">
					<textarea class="s_textarea" name="remark"></textarea>
				</div>
			</div>
			<!--是否有该正常店铺和购物车信息{$isshoppay}-->
			<input type="hidden" id="shipmoney1" value="{$shipmoney1}" />
			<div class="submit_node po_re"><button class="s_btn_gray" type="button" onClick="window.location.href='{$SiteUrl}member/myorder.aspx?action=myshoppay&shopid={$shopid}';">返回购物车</button>　<button class="s_btn_green" type="button" id="submitGo" onClick="GetsubmitGo(0);">提交订单，进入支付</button></div>
</form>
		</div>
	</div>
	<div class="footer">
		{$Mh163k_快送_页脚}
	</div>
</div>
<form id='submitpay' name='submitpay'  target="paysub" action='{$SiteUrl}pay/default.aspx' method='POST'>
<input type='hidden' name='formcode' id='formcode' value='payok'/>
<input type='SUBMIT' value='支付' style='display:none;'>
</form>
<iframe src="about:blank" id="pay" name="pay" height="0" width="0" scrolling="no" frameborder="no" border="0"></iframe>
<div class="sys_tips" id="pay_tips" style="display:none;">
	<div class="hd">支付</div>
	<div class="bd">
		<p>请您在新打开的支付平台页面进行支付，支付完成前请不要关闭该窗口。</p>
		<div class="btn"><a href="{$SiteUrl}member/myorder.aspx" class="btn1">已完成支付</a><a href="{$SiteUrl}help/" target="_blank" class="btn2">支付遇到问题</a></div>
		<a href="{$SiteUrl}member/myorder.aspx" class="close">重新选择支付方式</a>
	</div>
</div>
<script src="{$Default_tplPath}js/kuaisonCommon.js?{$CacheHash}"></script>
<script>

(function($){
	if($('#sleAdress0').attr('data-result') === '2'){
		$('#addressid').val('0');
		$('#addressList').find('.item').hide().end().find('.item0').show().end().show();
	}
	$('#sleAdress0').click(function(){
		if(!!$(this).prop('checked')){
			$('#addressid').val('0');
			$('#addressList').find('.cur1').removeClass('cur1');
		}
	});
	$('#addressList').addressList();
	$('#myformAddress').bind('submit',function(e){
		function checkmobile(value){
			return /^(13\d{9}|18\d{9}|14\d{9}|15\d{9}|659\d{7}|658\d{7})$/i.test(value) || /(\(\d{3,4}\)|\d{3,4}-|\s)?\d{8}/i.test(value);	
		}
		var $realname = $('#s_realname'),$address = $('#s_address'),$phone = $('#s_phone'),tip_error = $('#tip_error');
		if($realname.val() === ''){
			tip_error.html('请输入配送人姓名！');
			return false;
		}
		if($phone.val() === ''){
			tip_error.html('请输入电话号码！');
			return false;
		}
		if(!checkmobile($phone.val())){
			tip_error.html('请输入有效的电话号码！');
			return false;
		}
		if($address.val() === ''){
			tip_error.html('请输入配送地址！');
			return false;
		}
		addeditAddress(encodeURIComponent($realname.val()),encodeURIComponent($address.val()),encodeURIComponent($phone.val()),$('#s_id').val(),$('#s_styleid').val(),$('#s_ismoren').val());
		return false;
	});
	$('#shop_list').find('li a').each(function(){
		$(this).attr('href',siteUrl+'member/myorder.aspx?action=shoppay&shopid='+$(this).attr('data-id'));
	});
	showQison(parseFloat($('#shipmoney1').val()),parseFloat($('#chrmoneyAll').html()));
	
	if(!parseFloat($('#chrmoneyPay').html()) > 0){
		$('#payid98').prop('checked',true);
		$('#zhifuNode').hide();
		$('#submitGo').text('提交订单');
	}
})(jQuery);
function bankradio(payid){		
	if(payid=='2'||payid=='5'){
		 $("#bankradio").show();
	}else{
		$("#bankradio").hide();
	}
}
var rank_list = $("input[name='payid']");
rank_list.each(function(){
	if($(this).prop("checked")&&($(this).val() === '2' || $(this).val() === '5')){
		$("#bankradio").show();
	}
});
function checkMyform(val){
	var oform = document.getElementById("Form11");
	var kindid = document.getElementsByName("payid");
	var addressid = document.getElementById('addressid');
	if(addressid.value===''){
		alert("请选择一个收货地址！");
		return false;
	}
	for(var i=0;i<kindid.length;i++){
		if(kindid[i].checked && kindid[i].value=="2" && val=="0")
		{
			
		var p_mode = oform.pmode_id.value;
		  if(p_mode == "" || p_mode == 0){
			 alert("请选择支付银行和类型");
			 return false;	
		  }
		}
	}
	oform.submit();
	return true;
}
var win;
function GetsubmitGo(val){
	var backval = checkMyform(val);//判断参数和提交订单
	if(!backval){return;}
	if(val === 0){
		win = window.open("{$SiteUrl}pay/default.aspx?formcode=payok","paysub");
	}
}
function show1(thiz,pid){
	document.getElementById("Form11").pmode_id.value=pid;
}
</script>
</body>
</html>